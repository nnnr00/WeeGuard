<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>活动中心 – 开业庆典</title>
  <style>
    body {font-family:Arial,sans-serif;text-align:center;margin-top:30px;}
    .box {display:inline-block;padding:12px 20px;margin:10px;border:1px solid #888;
          border-radius:6px;background:#f9f9f9;}
    .counter {font-weight:bold;color:#d00;}
    button {padding:10px 18px;margin:5px;cursor:pointer;}
  </style>
</head>
<body>
  <div class="box">
    观看视频可获得积分，每日最多 3 次，已观看 <span id="videoCounter" class="counter">(0/3)</span> 次。&#13;
    说明页面每日可点击 2 次，已点击 <span id="explainCounter" class="counter">(0/2)</span> 次。
  </div>

  <div class="box"><button id="btn_video">按钮一：观看视频获取积分</button></div>
  <div class="box"><button id="btn_explain">按钮二：查看说明</button></div>

  <script>
    // 读取后端计数
    async function loadCounters(){
      const r = await fetch('/current_counters');
      const d = await r.json();
      document.getElementById('videoCounter').innerText = `$(d.video_used)/(3)`;
      document.getElementById('explainCounter').innerText = `$(d.explain_used)/(2)`;
    }
    loadCounters();

    // 获取管理员绑定的链接（若无则提示）
    async function fetchLinks(){
      const r = await fetch('/active_admin_links');
      const d = await r.json();
      return d;
    }

    // 按钮一 – 观看视频（3 秒后打开奖励视频）
    document.getElementById('btn_video').onclick = async () => {
      const used = await fetch('/current_counters').then(r=>r.json()).then(d=>d.video_used);
      if (used >= 3){
        alert('已达今日观看上限，请明天再来');
        return;
      }
      setTimeout(()=>{window.location.href = '{AD_AD_URL}';}, 3000);
    };

    // 按钮二 – 查看说明（3 秒后打开说明页）
    document.getElementById('btn_explain').onclick = async () => {{
      const links = await fetchLinks();
      if (!links.key1 || !links.key2){
        alert('请等待管理员更换新密钥链接');
        return;
      }
      setTimeout(()=>{{window.location.href = '/explanation_page.html';}}, 3000);
    }};
  </script>
</body>
</html>
