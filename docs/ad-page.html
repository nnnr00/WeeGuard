<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>观看广告领取积分</title>
<!-- 替换 data-zone 和 data-sdk 为你的广告SDK参数 -->
<script src="//libtl.com/sdk.js" data-zone="10489957" data-sdk="show_10489957"></script>
</head>
<body>
<h2>观看广告领取积分</h2>
<p>请点击下面按钮观看广告，观看至少5秒，观看完成后自动通知机器人发放积分。</p>
<button id="watchAdBtn">观看广告</button>
<p id="status"></p>

<script>
// 从URL获取user_id参数
const urlParams = new URLSearchParams(window.location.search);
const userId = urlParams.get('user_id');
const statusEl = document.getElementById('status');
const btn = document.getElementById('watchAdBtn');

btn.onclick = () => {
    statusEl.textContent = "广告加载中...";
    show_10489957('pop').then(() => {
        statusEl.textContent = "广告观看完成，正在通知机器人...";
        // 调用后端接口通知机器人广告观看成功
        fetch(`https://你的后端域名/api/mark_ad_watched?user_id=${userId}`)
            .then(res => res.json())
            .then(data => {
                if(data.success){
                    statusEl.textContent = "积分领取资格已激活，请返回机器人输入隐藏密令领取积分。";
                } else {
                    statusEl.textContent = "通知失败，请稍后重试。";
                }
            })
            .catch(() => {
                statusEl.textContent = "网络错误，通知失败。";
            });
    }).catch(() => {
        statusEl.textContent = "广告未完成观看，未获得积分。";
    });
};
</script>
</body>
</html>
