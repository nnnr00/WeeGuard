<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è§‚çœ‹è§†é¢‘è·å–ç§¯åˆ†</title>
    <style>
        body{
            font-family:Arial,Helvetica,sans-serif;
            text-align:center;
            margin-top:30px;
        }
        .button{
            background:#4CAF50;
            color:#ffffff;
            padding:12px 24px;
            margin:10px;
            border:none;
            border-radius:5px;
            cursor:pointer;
            font-size:16px;
        }
        .button:disabled{
            background:#bbbbbb;
            cursor:not-allowed;
        }
        #status{
            margin-top:15px;
            font-size:14px;
            color:#555;
        }
    </style>
</head>
<body>
    <h2>ğŸ¬ è§‚çœ‹è§†é¢‘è·å–ç§¯åˆ†</h2>
    <div id="ad-container">
        <!-- è¿™é‡Œæ˜¾ç¤º â€œè§‚çœ‹å¹¿å‘Šâ€ æŒ‰é’® -->
        <button id="watch-button" class="button">è§‚çœ‹å¹¿å‘Š</button>
    </div>

    <!-- ç”¨æ¥å±•ç¤ºçŠ¶æ€ä¿¡æ¯ï¼ˆæ’­æ”¾ä¸­ã€å·²å®Œæˆã€å‡ºé”™ç­‰ï¼‰ -->
    <div id="status"></div>

    <!-- ==================== SDK è„šæœ¬ ==================== -->
    <!-- 
        è¿™é‡Œä½¿ç”¨çš„ SDK åœ°å€å’Œ data å‚æ•°æ­£æ˜¯ä½ æä¾›çš„ç¤ºä¾‹
        <script src='//libtl.com/sdk.js' data-zone='10489957' data-sdk='show_10489957'></script>
     -->
    <script src='//libtl.com/sdk.js' data-zone='10489957' data-sdk='show_10489957'></script>

    <!-- ==================== é¡µé¢é€»è¾‘ ==================== -->
    <script>
        // ---------- å–å¾—é¡µé¢ä¼ é€’çš„ user_id ----------
        // é¡µé¢çš„ URL å½¢å¦‚ï¼š/webapp?user_id=123456789
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user_id') || '0';

        // ---------- ç¼“å­˜å¼•ç”¨ ----------
        const btn      = document.getElementById('watch-button');
        const status   = document.getElementById('status');

        // ---------- ç‚¹å‡»æŒ‰é’®è§‚çœ‹å¹¿å‘Š ----------
        btn.addEventListener('click', async () => {
            // é˜²æ­¢é‡å¤ç‚¹å‡»
            if (btn.classList.contains('disabled')) { return; }
            btn.classList.add('disabled');
            btn.disabled = true;
            status.textContent = 'â³ æ­£åœ¨æ’­æ”¾ï¼Œè¯·è§‚çœ‹è‡³ç»“æŸâ€¦';

            // ---------- è°ƒç”¨ SDK æ˜¾ç¤ºå¥–åŠ±å¹¿å‘Š ----------
            // è¿™é‡Œçš„ show_10489957('pop') ä¼šè¿”å›ä¸€ä¸ª Promise
            show_10489957('pop')
                .then(() => {
                    // âœ… ç”¨æˆ·å®Œæ•´è§‚çœ‹äº†è§†é¢‘ï¼Œå‘åç«¯æŠ¥å‘Šå®Œæˆ
                    return fetch('/ad_completed', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ user_id: userId })
                    });
                })
                .then(res => res.json())
                .then(data => {
                    if (data.status === 'ok') {
                        status.textContent = 'âœ… ç§¯åˆ†å·²å‘æ”¾ï¼Œæ„Ÿè°¢è§‚çœ‹ï¼';
                    } else {
                        status.textContent = 'âŒ è·å–ç§¯åˆ†å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚';
                    }
                })
                .catch(err => {
                    // âŒ ç”¨æˆ·æå‰å…³é—­æˆ–å‡ºç°é”™è¯¯ï¼ŒçŠ¶æ€æ¢å¤å¹¶æç¤º
                    console.error('å¹¿å‘Šæ’­æ”¾é”™è¯¯', err);
                    status.textContent = 'ğŸš« è§‚çœ‹å·²ä¸­æ­¢ï¼Œæœªè·å–ç§¯åˆ†ã€‚';
                    // é‡æ–°å¯ç”¨æŒ‰é’®ï¼Œè®©ç”¨æˆ·å¯ä»¥å†æ¬¡å°è¯•ï¼ˆæ¬¡æ—¥ä¹‹åæ‰ä¼šé‡ç½®è®¡æ•°ï¼‰
                    btn.classList.remove('disabled');
                    btn.disabled = false;
                });
        });
    </script>
</body>
</html>
