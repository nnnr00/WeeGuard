<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>活动中心 – 开业庆典</title>
  <style>
    body{font-family:Arial,sans-serif;text-align:center;margin-top:30px;}
    .box{
      display:inline-block;
      padding:12px 20px;
      margin:10px;
      border:1px solid #888;
      border-radius:6px;
      background:#f9f9f9;
    }
    .counter{font-weight:bold;color:#d00;}
    button{padding:10px 18px;margin:5px;cursor:pointer;}
  </style>
</head>
<body>
  <!-- 计数显示 -->
  <div class="box">
    观看视频可获得积分，每日最多 3 次，已观看
    <span id="videoCounter" class="counter">(0/3)</span> 次。<br>
    说明页面每日可点击 2 次，已点击
    <span id="explainCounter" class="counter">(0/2)</span> 次。
  </div>

  <div class="box"><button id="btn_video">按钮一：观看视频获取积分</button></div>
  <div class="box"><button id="btn_explain">按钮二：查看说明</button></div>

  <script>
    // ---------- 计数 ----------
    async function loadCounters(){
      const r = await fetch('/current_counters');
      const d = await r.json();
      document.getElementById('videoCounter').innerText = `$(d.video_used)/(3)`;
      document.getElementById('explainCounter').innerText = `$(d.explain_used)/(2)`;
    }
    loadCounters();

    // 读取已绑定的管理员链接（用于按鈕二）
    async function fetchLinks(){
      const r = await fetch('/active_admin_links');
      const d = await r.json();
      return d;
    }

    // 按鈕一 – 觀看視頻（3 秒後跳轉獎勵視頻）
    document.getElementById('btn_video').onclick = async () => {
      const used = await fetch('/current_counters')
        .then(r=>r.json())
        .then(d=>d.video_used);
      if (used >= 3){
        alert('已達今日觀看上限，請明天再來');
        return;
      }
      setTimeout(()=>{window.location.href = '{AD_ACTIVITY_URL}';}, 3000);
    };

    // 按鈕二 – 查看說明
    document.getElementById('btn_explain').onclick = async () => {
      const links = await fetchLinks();
      if (!links.key1 || !links.key2){
        alert('請等待管理员更换新密钥链接');
        return;
      }
      setTimeout(()=>{window.location.href = '/explanation_page.html';}, 3000);
    };
  </script>
</body>
</html>
